(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{4866:function(e,r,a){Promise.resolve().then(a.bind(a,8658))},8658:function(e,r,a){"use strict";a.r(r),a.d(r,{default:function(){return p}});var s=a(3827),t=a(4090),l=a(5230),d=a(7907),o=a(826),n=a(333);function i(e){let{isOpen:r,onClose:a}=e;return r?(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white dark:bg-dark-100 rounded-lg shadow-xl w-full max-w-md",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b dark:border-dark-200",children:[(0,s.jsx)("h3",{className:"text-lg font-medium",children:"个人资料"}),(0,s.jsx)("button",{onClick:a,className:"text-gray-500 hover:text-gray-700",children:(0,s.jsx)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,s.jsx)("div",{className:"p-6",children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"用户名"}),(0,s.jsx)("input",{type:"text",className:"w-full px-3 py-2 border rounded-md dark:border-dark-200 dark:bg-dark-200",defaultValue:"测试用户"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"邮箱"}),(0,s.jsx)("input",{type:"email",className:"w-full px-3 py-2 border rounded-md dark:border-dark-200 dark:bg-dark-200",defaultValue:"test@example.com"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"头像"}),(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)("img",{src:"https://api.dicebear.com/7.x/avataaars/svg?seed=Felix",alt:"用户头像",className:"w-16 h-16 rounded-full"}),(0,s.jsx)("button",{className:"px-3 py-1 text-sm border rounded-md hover:bg-gray-50 dark:border-dark-200 dark:hover:bg-dark-200",children:"更换头像"})]})]})]})}),(0,s.jsx)("div",{className:"flex justify-end px-6 py-4 border-t dark:border-dark-200",children:(0,s.jsx)("button",{className:"px-4 py-2 bg-primary-500 text-white rounded-md hover:bg-primary-600",onClick:a,children:"保存更改"})})]})}):null}function c(e){let{isOpen:r,onClose:a}=e;return r?(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white dark:bg-dark-100 rounded-lg shadow-xl w-full max-w-md",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b dark:border-dark-200",children:[(0,s.jsx)("h3",{className:"text-lg font-medium",children:"修改密码"}),(0,s.jsx)("button",{onClick:a,className:"text-gray-500 hover:text-gray-700",children:(0,s.jsx)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,s.jsx)("div",{className:"p-6",children:(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"当前密码"}),(0,s.jsx)("input",{type:"password",className:"w-full px-3 py-2 border rounded-md dark:border-dark-200 dark:bg-dark-200"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"新密码"}),(0,s.jsx)("input",{type:"password",className:"w-full px-3 py-2 border rounded-md dark:border-dark-200 dark:bg-dark-200"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"确认新密码"}),(0,s.jsx)("input",{type:"password",className:"w-full px-3 py-2 border rounded-md dark:border-dark-200 dark:bg-dark-200"})]})]})}),(0,s.jsx)("div",{className:"flex justify-end px-6 py-4 border-t dark:border-dark-200",children:(0,s.jsx)("button",{className:"px-4 py-2 bg-primary-500 text-white rounded-md hover:bg-primary-600",onClick:a,children:"确认修改"})})]})}):null}function x(){let[e,r]=(0,t.useState)(!1),[a,l]=(0,t.useState)(!1),[o,n]=(0,t.useState)(!1),x=(0,t.useRef)(null),m=(0,d.useRouter)();(0,t.useEffect)(()=>{function e(e){x.current&&!x.current.contains(e.target)&&r(!1)}return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[]);let h={name:"测试用户",avatar:"https://api.dicebear.com/7.x/avataaars/svg?seed=Felix"};return(0,s.jsxs)("div",{className:"relative",ref:x,children:[(0,s.jsxs)("button",{className:"flex items-center space-x-2 p-1 rounded-full hover:bg-gray-100 dark:hover:bg-dark-200 transition-colors",onClick:()=>r(!e),children:[(0,s.jsx)("img",{src:h.avatar,alt:h.name,className:"w-8 h-8 rounded-full"}),(0,s.jsx)("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-200",children:h.name}),(0,s.jsx)("svg",{className:"w-4 h-4 text-gray-500 transition-transform ".concat(e?"rotate-180":""),viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),e&&(0,s.jsxs)("div",{className:"absolute right-0 mt-2 w-48 bg-white dark:bg-dark-100 rounded-lg shadow-lg py-1 z-40",children:[(0,s.jsxs)("button",{className:"flex items-center w-full px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-dark-200",onClick:()=>{r(!1),l(!0)},children:[(0,s.jsx)("svg",{className:"w-4 h-4 mr-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"个人资料"]}),(0,s.jsxs)("button",{className:"flex items-center w-full px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-dark-200",onClick:()=>{r(!1),n(!0)},children:[(0,s.jsx)("svg",{className:"w-4 h-4 mr-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 7a2 2 0 012 2m4 0a6 6 0 01-7.743 5.743L11 17H9v2H7v2H4a1 1 0 01-1-1v-2.586a1 1 0 01.293-.707l5.964-5.964A6 6 0 1121 9z"})}),"修改密码"]}),(0,s.jsx)("hr",{className:"my-1 border-gray-200 dark:border-dark-300"}),(0,s.jsxs)("button",{className:"flex items-center w-full px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-gray-100 dark:hover:bg-dark-200",onClick:()=>{r(!1),m.push("/login")},children:[(0,s.jsx)("svg",{className:"w-4 h-4 mr-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),"退出登录"]})]}),(0,s.jsx)(i,{isOpen:a,onClose:()=>l(!1)}),(0,s.jsx)(c,{isOpen:o,onClose:()=>n(!1)})]})}var m=a(3151);function h(e){let{isOpen:r,book:a,onClose:l,onConfirm:d}=e,[o,i]=(0,t.useState)(1),[c,x]=(0,t.useState)((null==a?void 0:a.totalChapters)||1),[m,h]=(0,t.useState)(!1),u=(0,n.M)(e=>e.aiSettings);if((0,t.useEffect)(()=>{a&&x(a.totalChapters)},[a]),!r||!a)return null;let g=async()=>{h(!0);try{await d(o,c)}finally{h(!1)}};return(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-md mx-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700",children:[(0,s.jsx)("h3",{className:"text-lg font-medium",children:"批量转写设置"}),(0,s.jsx)("button",{onClick:l,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",disabled:m,children:(0,s.jsx)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,s.jsxs)("div",{className:"p-6 space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"书籍名称"}),(0,s.jsx)("input",{type:"text",className:"w-full px-3 py-2 border rounded-md bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 cursor-not-allowed",value:a.bookName,disabled:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"总章节数"}),(0,s.jsx)("input",{type:"text",className:"w-full px-3 py-2 border rounded-md bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 cursor-not-allowed",value:a.totalChapters,disabled:!0})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"批量范围"}),(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:"开始章节"}),(0,s.jsx)("input",{type:"number",min:1,max:a.totalChapters,className:"w-full px-3 py-2 border rounded-md dark:bg-gray-700 border-gray-300 dark:border-gray-600",value:o,onChange:e=>{let r=parseInt(e.target.value);r>=1&&r<=a.totalChapters&&(i(r),r>c&&x(r))},disabled:m})]}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsx)("label",{className:"block text-xs text-gray-500 dark:text-gray-400 mb-1",children:"结束章节"}),(0,s.jsx)("input",{type:"number",min:o,max:a.totalChapters,className:"w-full px-3 py-2 border rounded-md dark:bg-gray-700 border-gray-300 dark:border-gray-600",value:c,onChange:e=>{let r=parseInt(e.target.value);r>=o&&r<=a.totalChapters&&x(r)},disabled:m})]})]})]}),(0,s.jsxs)("div",{className:"pt-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,s.jsx)("span",{children:"当前蓝思值"}),(0,s.jsx)("span",{children:u.lexileScore})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm mt-1",children:[(0,s.jsx)("span",{children:"预计消耗积分"}),(0,s.jsxs)("span",{children:[(c-o+1)*5," 积分"]})]})]})]}),(0,s.jsxs)("div",{className:"flex justify-end p-4 border-t border-gray-200 dark:border-gray-700",children:[(0,s.jsx)("button",{className:"px-4 py-2 mr-2 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 transition-colors",onClick:l,disabled:m,children:"取消"}),(0,s.jsx)("button",{className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600 transition-colors flex items-center ".concat(m?"opacity-70 cursor-not-allowed":""),onClick:g,disabled:m,children:m?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"处理中..."]}):"开始转写"})]})]})})}function u(e){let{isOpen:r,book:a,onClose:t,onConfirm:l}=e;return r&&a?(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white dark:bg-dark-100 rounded-lg shadow-xl w-full max-w-md mx-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-dark-300",children:[(0,s.jsx)("h3",{className:"text-lg font-medium",children:"确认删除"}),(0,s.jsx)("button",{onClick:t,className:"text-gray-500 hover:text-gray-700",children:(0,s.jsx)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,s.jsxs)("div",{className:"p-6",children:[(0,s.jsxs)("div",{className:"flex items-center mb-4",children:[(0,s.jsx)("svg",{className:"w-8 h-8 text-red-500 mr-3",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),(0,s.jsx)("p",{className:"text-lg font-medium",children:"确定要删除这本书吗？"})]}),(0,s.jsxs)("p",{className:"text-gray-600 dark:text-gray-400 mb-2",children:["您即将删除：",(0,s.jsx)("span",{className:"font-medium text-gray-800 dark:text-gray-200",children:a.bookName})]}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-400 text-sm",children:"删除后将无法恢复，包括阅读进度、笔记和高亮等相关数据。"})]}),(0,s.jsxs)("div",{className:"flex justify-end p-4 border-t dark:border-dark-300",children:[(0,s.jsx)("button",{className:"px-4 py-2 mr-2 border border-gray-300 rounded-md hover:bg-gray-50 dark:border-dark-500 dark:hover:bg-dark-200",onClick:t,children:"取消"}),(0,s.jsx)("button",{className:"px-4 py-2 bg-red-500 text-white rounded-md hover:bg-red-600",onClick:l,children:"确认删除"})]})]})}):null}function g(e){let{message:r,type:a="info",onClose:l,duration:d=3e3}=e;return(0,t.useEffect)(()=>{let e=setTimeout(()=>{l()},d);return()=>clearTimeout(e)},[d,l]),(0,s.jsx)("div",{className:"fixed bottom-4 right-4 z-50 p-4 rounded-lg shadow-lg ".concat("success"===a?"bg-green-500":"error"===a?"bg-red-500":"bg-blue-500"," text-white"),children:(0,s.jsxs)("div",{className:"flex items-center",children:["success"===a&&(0,s.jsx)("svg",{className:"w-5 h-5 mr-2",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),"error"===a&&(0,s.jsx)("svg",{className:"w-5 h-5 mr-2",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})}),"info"===a&&(0,s.jsx)("svg",{className:"w-5 h-5 mr-2",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z",clipRule:"evenodd"})}),(0,s.jsx)("span",{children:r})]})})}var b=a(311);function k(e){let{isOpen:r,onClose:a,onImport:l}=e,[d,o]=(0,t.useState)(null),[n,i]=(0,t.useState)(""),[c,x]=(0,t.useState)([]),[m,h]=(0,t.useState)(!1),[u,k]=(0,t.useState)({show:!1,message:"",type:"info"}),p=(0,t.useRef)(null),y=async()=>{if(d){h(!0),x([]);try{let e=await j(d),r=f(e);x(r)}catch(e){console.error("处理文件时出错:",e),k({show:!0,message:"处理文件时出错，请重试",type:"error"})}finally{h(!1)}}},j=e=>new Promise((r,a)=>{let s=new FileReader;s.onload=e=>{var s;(null===(s=e.target)||void 0===s?void 0:s.result)?r(e.target.result):a(Error("读取文件失败"))},s.onerror=()=>a(Error("读取文件失败")),s.readAsText(e,"UTF-8")}),f=e=>{let r=[],a=0,s=1,t=e.replace(/\r\n/g,"\n").replace(/\n{3,}/g,"\n\n");for(;a<t.length;){let e=Math.min(a+3e3,t.length);if(e<t.length){let r=t.lastIndexOf("\n\n",e);if(r>a&&r<=e-100)e=r+2;else{let r=Math.max(t.lastIndexOf(". ",e),t.lastIndexOf("。",e),t.lastIndexOf("！",e),t.lastIndexOf("？",e));r>a&&r<=e-20&&(e=r+1)}}let l=t.substring(a,e);r.push({chapterName:"第 ".concat(s," 页"),content:l,order:s}),a=e,s++}return r},v=async()=>{if(0===c.length){k({show:!0,message:"没有内容可导入",type:"error"});return}try{await l({bookName:n,chapters:c}),w(),a()}catch(e){console.error("导入书籍时出错:",e),k({show:!0,message:"导入书籍时出错，请重试",type:"error"})}},w=()=>{o(null),i(""),x([]),p.current&&(p.current.value="")},N=()=>{w(),a()};return((0,t.useEffect)(()=>{d&&y()},[d]),(0,t.useEffect)(()=>{r||w()},[r]),r)?(0,s.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:[(0,s.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-2xl max-h-[80vh] flex flex-col",children:[(0,s.jsxs)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-800 dark:text-white",children:"导入TXT书籍"}),(0,s.jsx)("button",{onClick:N,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:(0,s.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,s.jsx)("div",{className:"p-4 flex-1 overflow-auto",children:d?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block text-gray-700 dark:text-gray-300 mb-2",children:"书籍名称"}),(0,s.jsx)("input",{type:"text",value:n,onChange:e=>i(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-700 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]}),m?(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center h-48",children:[(0,s.jsx)("div",{className:"w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mb-4"}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"正在分析内容，请稍候..."})]}):c.length>0?(0,s.jsxs)("div",{children:[(0,s.jsxs)("h3",{className:"text-lg font-semibold mb-2 text-gray-800 dark:text-white",children:["共分割为 ",c.length," 页"]}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[(0,s.jsx)("thead",{className:"bg-gray-50 dark:bg-gray-800",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"序号"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:"内容长度"})]})}),(0,s.jsx)("tbody",{className:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-800",children:c.map((e,r)=>(0,s.jsxs)("tr",{className:r%2==0?"bg-white dark:bg-gray-900":"bg-gray-50 dark:bg-gray-800",children:[(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:e.order}),(0,s.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 dark:text-gray-400",children:[e.content.length," 字符"]})]},r))})]})})]}):(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center h-48",children:[(0,s.jsx)("svg",{className:"w-12 h-12 text-yellow-500 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"文件内容为空"})]})]}):(0,s.jsxs)("div",{className:"flex flex-col items-center justify-center h-48 border-2 border-dashed border-gray-300 dark:border-gray-700 rounded-lg",children:[(0,s.jsx)("svg",{className:"w-12 h-12 text-gray-400 mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"点击或拖拽TXT文件到此处"}),(0,s.jsx)("input",{type:"file",accept:".txt",onChange:e=>{if(e.target.files&&e.target.files.length>0){let r=e.target.files[0];o(r),i(r.name.replace(/\.[^/.]+$/,""))}},className:"hidden",ref:p}),(0,s.jsx)(b.A,{onClick:()=>{var e;return null===(e=p.current)||void 0===e?void 0:e.click()},color:"primary",children:"选择文件"})]})}),(0,s.jsxs)("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 flex justify-end space-x-2",children:[(0,s.jsx)(b.A,{onClick:N,color:"default",variant:"bordered",children:"取消"}),d&&c.length>0&&(0,s.jsx)(b.A,{onClick:v,color:"primary",children:"导入"})]})]}),u.show&&(0,s.jsx)(g,{message:u.message,type:u.type,onClose:()=>k(e=>({...e,show:!1}))})]}):null}function p(){let e=(0,d.useRouter)(),r=(0,l.useQueryClient)(),[a,i]=(0,t.useState)(!1),[c,b]=(0,t.useState)(!1),[p,y]=(0,t.useState)(!1),[j,f]=(0,t.useState)(!1),[v,w]=(0,t.useState)(!1),[N,C]=(0,t.useState)(null),[L,M]=(0,t.useState)(""),[z,S]=(0,t.useState)(!1),[B,I]=(0,t.useState)({show:!1,message:"",type:"info"}),E=(0,n.M)(e=>e.aiSettings),{data:W,isLoading:A,error:O}=(0,l.useQuery)("books",()=>(0,o.yt)()),R=(null==W?void 0:W.content.filter(e=>e.bookName.toLowerCase().includes(L.toLowerCase())||e.author.toLowerCase().includes(L.toLowerCase())))||[];(0,t.useEffect)(()=>{let e=localStorage.getItem("darkMode"),r=window.matchMedia("(prefers-color-scheme: dark)").matches,a="dark"===e||null===e&&r;S(a),a?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},[]);let H=r=>{e.push("/books/".concat(r.bookId))},T=e=>{C(e),y(!0)},V=e=>{C(e),f(!0)},F=async(e,r)=>{if(N)try{console.log("开始批量转写:",N.bookId,e,r,E.lexileScore);let a=await (0,o.a8)(N.bookId,e,r,E.lexileScore);return console.log("批量转写结果:",a),a.success?I({show:!0,message:"批量转写任务已提交，请稍后查看结果",type:"success"}):I({show:!0,message:"批量转写失败: ".concat(a.message),type:"error"}),y(!1),a}catch(e){throw console.error("批量转写出错:",e),I({show:!0,message:"批量转写请求出错，请稍后再试",type:"error"}),y(!1),e}},_=async()=>{if(N)try{let e=await (0,o.MC)(N.bookId);e.success?(r.invalidateQueries("books"),I({show:!0,message:"书籍已成功删除",type:"success"})):I({show:!0,message:"删除失败: ".concat(e.message),type:"error"})}catch(e){console.error("删除书籍出错:",e),I({show:!0,message:"删除书籍请求出错，请稍后再试",type:"error"})}finally{f(!1)}},Q=async e=>{try{let a=await (0,o.QI)(e);a.success?(r.invalidateQueries("books"),I({show:!0,message:"书籍导入成功",type:"success"})):I({show:!0,message:"导入失败: ".concat(a.message),type:"error"})}catch(e){console.error("导入书籍出错:",e),I({show:!0,message:"导入书籍请求出错，请稍后再试",type:"error"})}};return(0,s.jsxs)("main",{className:"min-h-screen bg-gray-50 dark:bg-[#1a1a1a] flex flex-col",children:[(0,s.jsx)("header",{className:"bg-white dark:bg-[#1a1a1a] shadow-sm text-gray-800 dark:text-white p-4",children:(0,s.jsxs)("div",{className:"container mx-auto flex justify-between items-center",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:"ABHISECA"}),(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)("button",{onClick:()=>{let e=!z;S(e),e?(document.documentElement.classList.add("dark"),localStorage.setItem("darkMode","dark")):(document.documentElement.classList.remove("dark"),localStorage.setItem("darkMode","light"))},className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors","aria-label":z?"切换到亮色模式":"切换到暗色模式",children:z?(0,s.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z",clipRule:"evenodd"})}):(0,s.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:(0,s.jsx)("path",{d:"M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"})})}),(0,s.jsx)("button",{onClick:()=>b(!0),className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors text-blue-500","aria-label":"AI转写设置",children:(0,s.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})})})]}),(0,s.jsx)(x,{})]})]})}),(0,s.jsxs)("div",{className:"container mx-auto px-4 py-6 flex-1",children:[(0,s.jsx)("div",{className:"mb-6",children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("input",{type:"text",placeholder:"搜索书籍...",value:L,onChange:e=>M(e.target.value),className:"w-full px-4 py-2 rounded-lg border dark:border-gray-700 bg-white dark:bg-[#1a1a1a] text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"}),(0,s.jsx)("svg",{className:"w-5 h-5 absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]})}),(0,s.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4",children:[(0,s.jsxs)("button",{onClick:()=>w(!0),className:"aspect-[4/5] rounded-lg border-2 border-dashed dark:border-gray-700 flex flex-col items-center justify-center p-4 text-gray-400 dark:text-gray-500 hover:text-gray-500 dark:hover:text-gray-400 hover:border-gray-500 dark:hover:border-gray-400 transition-colors bg-white dark:bg-[#1a1a1a]",children:[(0,s.jsx)("svg",{className:"w-8 h-8 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})}),(0,s.jsx)("span",{className:"text-xs",children:"导入新书籍"})]}),R.map(e=>(0,s.jsx)("div",{className:"aspect-[4/5] rounded-lg border dark:border-gray-700 bg-white dark:bg-[#1a1a1a] shadow-sm hover:shadow-md transition-shadow relative group overflow-hidden",children:(0,s.jsxs)("button",{onClick:()=>H(e),className:"w-full h-full flex flex-col relative",children:[(0,s.jsxs)("div",{className:"flex-1 flex items-center justify-center bg-gradient-to-br from-gray-50 to-gray-100 dark:from-[#1a1a1a] dark:to-[#242424] relative overflow-hidden",children:[(0,s.jsx)("div",{className:"absolute w-48 h-48 rounded-full border-[16px] border-gray-100 dark:border-[#242424] opacity-50 -top-12 -right-12 transform rotate-12"}),(0,s.jsx)("div",{className:"absolute w-32 h-32 rounded-full border-[12px] border-gray-100 dark:border-[#242424] opacity-30 bottom-4 -left-8"}),(0,s.jsxs)("div",{className:"relative transform hover:scale-105 transition-transform duration-300",children:[(0,s.jsx)("span",{className:"text-8xl font-black text-transparent bg-clip-text bg-gradient-to-br from-gray-300 to-gray-100 dark:from-gray-500 dark:to-gray-700 select-none filter drop-shadow-lg",children:e.bookName.charAt(0).toUpperCase()}),(0,s.jsx)("span",{className:"absolute inset-0 text-8xl font-black text-gray-200 dark:text-[#242424] select-none blur-sm opacity-60 transform -translate-y-1 translate-x-1",children:e.bookName.charAt(0).toUpperCase()})]})]}),(0,s.jsxs)("div",{className:"p-3 bg-white/90 dark:bg-[#1a1a1a] backdrop-blur-sm border-t dark:border-[#242424]",children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-gray-900 dark:text-white truncate",children:e.bookName}),(0,s.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1 truncate",children:e.author}),(0,s.jsxs)("div",{className:"flex items-center text-xs text-gray-500 dark:text-gray-400 mt-2",children:[(0,s.jsxs)("span",{children:[e.totalChapters," 章"]}),(0,s.jsx)("span",{className:"mx-1",children:"\xb7"}),(0,s.jsxs)("span",{children:[e.wordCount," 字"]})]})]}),(0,s.jsxs)("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity flex space-x-1",children:[(0,s.jsx)("button",{onClick:r=>{r.stopPropagation(),T(e)},className:"p-1.5 rounded-full bg-white/80 dark:bg-[#1a1a1a]/90 text-gray-600 hover:text-blue-500 dark:text-gray-400 dark:hover:text-blue-400",title:"AI转写",children:(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})})}),(0,s.jsx)("button",{onClick:r=>{r.stopPropagation(),V(e)},className:"p-1.5 rounded-full bg-white/80 dark:bg-[#1a1a1a]/90 text-gray-600 hover:text-red-500 dark:text-gray-400 dark:hover:text-red-400",title:"删除",children:(0,s.jsx)("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})},e.bookId))]})]}),(0,s.jsx)(m.Z,{isOpen:c,enabled:a,onClose:()=>b(!1),onEnableChange:i}),(0,s.jsx)(h,{isOpen:p,onClose:()=>y(!1),onConfirm:F,book:N}),(0,s.jsx)(u,{isOpen:j,onClose:()=>f(!1),onConfirm:_,book:N}),(0,s.jsx)(k,{isOpen:v,onClose:()=>w(!1),onImport:Q}),B.show&&(0,s.jsx)(g,{message:B.message,type:B.type,onClose:()=>I({...B,show:!1})})]})}}},function(e){e.O(0,[230,21,350,311,79,971,69,744],function(){return e(e.s=4866)}),_N_E=e.O()}]);