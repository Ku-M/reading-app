"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[79],{3151:function(e,t,r){r.d(t,{Z:function(){return o}});var s=r(3827),a=r(4090),n=r(333),i=r(9313);function o(e){let{isOpen:t,enabled:r,onClose:o,onEnableChange:l}=e,c=(0,n.M)(e=>e.aiSettings),d=(0,n.M)(e=>e.updateAISettings),[m,h]=(0,a.useState)(c.lexileScore),[u,g]=(0,a.useState)(c.priorityWords.join(", ")),[p,x]=(0,a.useState)(!1);return((0,a.useEffect)(()=>{let e=()=>{x(window.innerWidth<768)};return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]),t)?(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-white dark:bg-dark-100 ".concat(p?"w-full h-full":"rounded-lg max-w-md mx-4"," shadow-xl"),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between p-4 border-b dark:border-dark-300",children:[(0,s.jsx)("h3",{className:"text-lg font-medium",children:"AI 转写设置"}),(0,s.jsx)("button",{onClick:o,className:"text-gray-500 hover:text-gray-700",children:(0,s.jsx)("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,s.jsxs)("div",{className:"".concat(p?"p-4 h-[calc(100vh-120px)] overflow-y-auto":"p-4"),children:[(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("label",{className:"font-medium text-gray-700 dark:text-gray-300",children:"启用 AI 转写"}),(0,s.jsxs)("div",{className:"relative inline-block w-10 align-middle select-none",children:[(0,s.jsx)("input",{type:"checkbox",checked:r,onChange:e=>l(e.target.checked),className:"sr-only",id:"ai-toggle"}),(0,s.jsx)("label",{htmlFor:"ai-toggle",className:"block h-6 overflow-hidden rounded-full cursor-pointer transition-colors duration-200 ease-in-out ".concat(r?"bg-primary-500":"bg-gray-300 dark:bg-dark-300"),children:(0,s.jsx)("span",{className:"block h-6 w-6 rounded-full bg-white shadow transform transition-transform duration-200 ease-in-out ".concat(r?"translate-x-4":"translate-x-0")})})]})]}),(0,s.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"启用后，系统将使用 AI 技术自动转写文本，使其更易于理解"})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"蓝思值"}),(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("button",{className:"p-2 bg-gray-100 dark:bg-dark-200 rounded-l-md hover:bg-gray-200 dark:hover:bg-dark-300 disabled:opacity-50",onClick:()=>h(Math.max(500,m-50)),disabled:!r,children:(0,s.jsx)("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M20 12H4"})})}),(0,s.jsx)("input",{type:"range",min:"500",max:"1500",step:"50",value:m,onChange:e=>h(parseInt(e.target.value,10)),className:"slider flex-1 mx-2",disabled:!r}),(0,s.jsx)("button",{className:"p-2 bg-gray-100 dark:bg-dark-200 rounded-r-md hover:bg-gray-200 dark:hover:bg-dark-300 disabled:opacity-50",onClick:()=>h(Math.min(1500,m+50)),disabled:!r,children:(0,s.jsx)("svg",{className:"h-4 w-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})})]}),(0,s.jsxs)("div",{className:"flex justify-between text-sm text-gray-500 mt-1",children:[(0,s.jsx)("span",{children:"简单"}),(0,s.jsx)("span",{children:m}),(0,s.jsx)("span",{children:"复杂"})]})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"优先词汇"}),(0,s.jsx)("textarea",{className:"w-full px-3 py-2 border rounded-md dark:bg-dark-200 dark:border-dark-300 disabled:opacity-50",rows:3,placeholder:"输入优先使用的词汇，用逗号分隔",value:u,onChange:e=>g(e.target.value),disabled:!r}),(0,s.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:"AI 转写时会优先使用这些词汇"})]}),(0,s.jsxs)("div",{className:"pt-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,s.jsx)("span",{children:"已消耗积分"}),(0,s.jsx)("span",{children:c.credits})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm mt-1",children:[(0,s.jsx)("span",{children:"平均每章消耗"}),(0,s.jsx)("span",{children:"5 积分"})]})]})]}),(0,s.jsxs)("div",{className:"flex justify-end gap-2 p-4 border-t dark:border-dark-300",children:[(0,s.jsx)(i.Z,{variant:"ghost",onClick:o,children:"取消"}),(0,s.jsx)(i.Z,{variant:"primary",onClick:()=>{d({enabled:r,lexileScore:m,priorityWords:u.split(",").map(e=>e.trim()).filter(Boolean)}),o()},children:"保存"})]})]})}):null}},9313:function(e,t,r){var s=r(3827),a=r(4090),n=r(1367);let i=(0,a.forwardRef)((e,t)=>{let{className:r,variant:a="primary",size:i="md",isLoading:o=!1,disabled:l,children:c,...d}=e;return(0,s.jsxs)("button",{ref:t,className:(0,n.m6)("inline-flex items-center justify-center rounded-md font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-primary-500 disabled:pointer-events-none disabled:opacity-50",{primary:"bg-primary-500 text-white hover:bg-primary-600",secondary:"bg-primary-100 text-primary-900 hover:bg-primary-200 dark:bg-primary-900/10 dark:text-primary-100 dark:hover:bg-primary-900/20",ghost:"hover:bg-primary-100 hover:text-primary-900 dark:hover:bg-primary-900/10 dark:hover:text-primary-100"}[a],{sm:"h-8 px-3 text-sm",md:"h-10 px-4",lg:"h-12 px-6 text-lg"}[i],r),disabled:o||l,...d,children:[o?(0,s.jsxs)("svg",{className:"mr-2 h-4 w-4 animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}):null,c]})});i.displayName="Button",t.Z=i},826:function(e,t,r){r.d(t,{F3:function(){return n},MC:function(){return d},QI:function(){return m},a8:function(){return c},lc:function(){return i},p0:function(){return o},xQ:function(){return l},yt:function(){return a}});let s=r(3107).Z.create({baseURL:"http://175.178.190.253:8081/api",timeout:1e4});async function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"bookName",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"asc",{data:n}=await s.get("/books",{params:{page:e,size:t,sortBy:r,direction:a}});return n}async function n(e){let{data:t}=await s.get("/books/".concat(e));return t}async function i(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"chapterName",n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"asc",{data:i}=await s.get("/chapters/book/".concat(e),{params:{page:t,size:r,sortBy:a,direction:n}});return i}async function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:100,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"chapterOrder",n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"asc",{data:i}=await s.get("/chapters/book/".concat(e,"/with-lexile"),{params:{page:t,size:r,sortBy:a,direction:n}});return i}async function l(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0;console.log("=== API 调用 fetchChapter 开始 ==="),console.log("参数:",{chapterId:e,startAI:t,lexileNo:r,priorityVocabulary:a});try{let{data:n}=await s.get("/chapters/".concat(e),{params:{startAI:t,...r&&{lexileNo:r},...a&&{priorityVocabulary:a},_t:Date.now()}});return console.log("=== API 调用 fetchChapter 成功 ==="),console.log("返回数据:",{chapterId:n.chapterId,chapterName:n.chapterName}),n}catch(e){throw console.error("=== API 调用 fetchChapter 失败 ===",e),e}}async function c(e,t,r,a){if(!e)return{success:!1,message:"书籍ID不能为空"};console.log("开始批量转写书籍 ".concat(e," 的章节 ").concat(t," 到 ").concat(r,"，蓝思值: ").concat(a));try{let{data:n}=await s.post("/books/".concat(e,"/batch-transcribe"),null,{params:{startChapter:t,endChapter:r,lexileScore:a}});if(console.log("批量转写响应:",n),!n.success&&"该书籍没有章节"===n.message)return{success:!1,message:"该书籍没有章节。请先导入章节内容，或者检查书籍ID是否正确。"};return n}catch(e){var n,i,o;return console.error("批量转写失败:",(null===(n=e.response)||void 0===n?void 0:n.data)||e.message),{success:!1,message:(null===(o=e.response)||void 0===o?void 0:null===(i=o.data)||void 0===i?void 0:i.message)||"批量转写请求失败，请稍后再试"}}}async function d(e){console.log("删除书籍 ".concat(e));try{let{data:t}=await s.delete("/books/".concat(e));return t}catch(e){return console.error("删除书籍失败:",e),{success:!1,message:"删除书籍请求失败"}}}async function m(e){try{console.log("开始导入书籍:",e.bookName,"章节数:",e.chapters.length);let t={bookName:e.bookName,chapters:e.chapters.map(e=>({chapterName:e.chapterName,content:e.content,order:e.order}))},{data:r}=await s.post("/books/import",t);return console.log("导入书籍成功:",r),{success:!0===r.success,message:r.message||"书籍导入成功",bookId:r.bookId}}catch(e){var t,r,a;return console.error("导入书籍失败:",(null===(t=e.response)||void 0===t?void 0:t.data)||e.message),{success:!1,message:(null===(a=e.response)||void 0===a?void 0:null===(r=a.data)||void 0===r?void 0:r.message)||"导入书籍失败，请稍后再试"}}}s.interceptors.response.use(e=>e,e=>{if(e.response){let{status:t,data:r}=e.response;console.error("API Error (".concat(t,"):"),r)}else e.request?console.error("Request Error:",e.request):console.error("Error:",e.message);return Promise.reject(e)})},333:function(e,t,r){r.d(t,{M:function(){return n}});var s=r(2020),a=r(5249);let n=(0,s.Ue)()((0,a.tJ)(e=>({settings:{fontSize:16,fontFamily:"system-ui",lineHeight:1.5,letterSpacing:0,theme:"light"},updateSettings:t=>e(e=>({settings:{...e.settings,...t}})),aiSettings:{enabled:!1,lexileScore:1e3,priorityWords:[],credits:100},updateAISettings:t=>e(e=>({aiSettings:{...e.aiSettings,...t}})),readingProgress:{},updateReadingProgress:t=>e(e=>({readingProgress:{...e.readingProgress,[t.bookId]:t}})),isToolbarVisible:!0,setToolbarVisible:t=>e({isToolbarVisible:t}),isSettingsDialogVisible:!1,setSettingsDialogVisible:t=>e({isSettingsDialogVisible:t}),isChapterListVisible:!1,setChapterListVisible:t=>e({isChapterListVisible:t})}),{name:"reader-store",version:1}))}}]);